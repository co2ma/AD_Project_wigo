{% extends 'base.html' %}

{% block content %}
<div class="container my-3">
    <!-- í˜ì´ì§€ í—¤ë” -->
    <div class="jumbotron">
        <h1 class="display-4">ğŸ“š ì±… ì •ë³´ ì—…ë¡œë“œ</h1>
        <p class="lead">í…ìŠ¤íŠ¸ ì…ë ¥ ë˜ëŠ” CSV/JSON íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ë„ì„œ ì •ë³´ë¥¼ ì¼ê´„ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        <hr class="my-4">
        <a href="{% url 'pybo:index' %}" class="btn btn-secondary">â† ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>

    <!-- ì…ë ¥ ë°©ë²• ì„ íƒ íƒ­ -->
    <ul class="nav nav-tabs mb-4" id="uploadTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <a class="nav-link active" id="text-tab" data-toggle="tab" href="#text" role="tab" aria-controls="text" aria-selected="true">
                ğŸ“ í…ìŠ¤íŠ¸ ì…ë ¥
            </a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="file-tab" data-toggle="tab" href="#file" role="tab" aria-controls="file" aria-selected="false">
                ğŸ“ íŒŒì¼ ì—…ë¡œë“œ
            </a>
        </li>
    </ul>

    <div class="tab-content" id="uploadTabContent">
        <!-- í…ìŠ¤íŠ¸ ì…ë ¥ íƒ­ -->
        <div class="tab-pane fade show active" id="text" role="tabpanel" aria-labelledby="text-tab">
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">ğŸ“ í…ìŠ¤íŠ¸ ì…ë ¥ í˜•ì‹</h5>
                        </div>
                        <div class="card-body">
                            <p>í•œ ì¤„ì— í•˜ë‚˜ì˜ ë„ì„œ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”:</p>
                            <pre class="bg-light p-2 rounded">ì œëª© | ì €ì | ì¶œíŒì‚¬ | ì¶œíŒë…„ë„
íŒŒì´ì¬ í”„ë¡œê·¸ë˜ë° | ê¹€ì² ìˆ˜ | í•œë¹›ë¯¸ë””ì–´ | 2023
ì¥ê³  ì›¹ ê°œë°œ | ì´ì˜í¬ | ì •ë³´ë¬¸í™”ì‚¬ | 2022
ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ | ë°•ë¯¼ìˆ˜ | êµë³´ë¬¸ê³  | 2021</pre>
                            <p class="text-muted small">* êµ¬ë¶„ì: | (íŒŒì´í”„), , (ì‰¼í‘œ), íƒ­, - (í•˜ì´í”ˆ), / (ìŠ¬ë˜ì‹œ)</p>
                            <p class="text-muted small">* ì œëª©ê³¼ ì €ìëŠ” í•„ìˆ˜, ì¶œíŒì‚¬ì™€ ì¶œíŒë…„ë„ëŠ” ì„ íƒì‚¬í•­</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">ğŸ’¡ ì…ë ¥ ì˜ˆì‹œ</h5>
                        </div>
                        <div class="card-body">
                            <p>ë‹¤ì–‘í•œ í˜•ì‹ìœ¼ë¡œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤:</p>
                            <pre class="bg-light p-2 rounded">íŒŒì´ì¬ í”„ë¡œê·¸ë˜ë°, ê¹€ì² ìˆ˜, í•œë¹›ë¯¸ë””ì–´, 2023
ì¥ê³  ì›¹ ê°œë°œ - ì´ì˜í¬ - ì •ë³´ë¬¸í™”ì‚¬ - 2022
ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ / ë°•ë¯¼ìˆ˜ / êµë³´ë¬¸ê³  / 2021
ì›¹ ê°œë°œ ì‹¤ì „ ìµœì§€ì˜ ê¸¸ë²— 2020</pre>
                            <p class="text-muted small">* ìë™ìœ¼ë¡œ êµ¬ë¶„ìë¥¼ ì¸ì‹í•˜ì—¬ íŒŒì‹±í•©ë‹ˆë‹¤</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- í…ìŠ¤íŠ¸ ì…ë ¥ í¼ -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">ğŸ“¤ í…ìŠ¤íŠ¸ ì…ë ¥</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="title">ì…ë ¥ ì„¤ëª…</label>
                            <input type="text" class="form-control" id="title" name="title" placeholder="ì˜ˆ: ë„ì„œê´€ ì‹ ê·œ ë„ì„œ ëª©ë¡" value="{{ title|default:'' }}">
                        </div>
                        <div class="form-group">
                            <label for="text_data">ë„ì„œ ì •ë³´ ì…ë ¥</label>
                            <textarea class="form-control" id="text_data" name="text_data" rows="10" placeholder="ì œëª© | ì €ì | ì¶œíŒì‚¬ | ì¶œíŒë…„ë„&#10;íŒŒì´ì¬ í”„ë¡œê·¸ë˜ë° | ê¹€ì² ìˆ˜ | í•œë¹›ë¯¸ë””ì–´ | 2023&#10;ì¥ê³  ì›¹ ê°œë°œ | ì´ì˜í¬ | ì •ë³´ë¬¸í™”ì‚¬ | 2022">{{ text_data }}</textarea>
                            <small class="form-text text-muted">í•œ ì¤„ì— í•˜ë‚˜ì˜ ë„ì„œ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”. ì œëª©ê³¼ ì €ìëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.</small>
                        </div>
                        <button type="submit" class="btn btn-primary">ë“±ë¡í•˜ê¸°</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- íŒŒì¼ ì—…ë¡œë“œ íƒ­ -->
        <div class="tab-pane fade" id="file" role="tabpanel" aria-labelledby="file-tab">
            <!-- íŒŒì¼ í˜•ì‹ ì•ˆë‚´ -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">ğŸ“„ CSV íŒŒì¼ í˜•ì‹</h5>
                        </div>
                        <div class="card-body">
                            <p>CSV íŒŒì¼ì€ ë‹¤ìŒê³¼ ê°™ì€ í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤:</p>
                            <pre class="bg-light p-2 rounded">title,author,publisher,publication_year
íŒŒì´ì¬ í”„ë¡œê·¸ë˜ë°,ê¹€ì² ìˆ˜,í•œë¹›ë¯¸ë””ì–´,2023
ì¥ê³  ì›¹ ê°œë°œ,ì´ì˜í¬,ì •ë³´ë¬¸í™”ì‚¬,2022
ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„,ë°•ë¯¼ìˆ˜,êµë³´ë¬¸ê³ ,2021</pre>
                            <p class="text-muted small">* titleê³¼ authorëŠ” í•„ìˆ˜, publisherì™€ publication_yearëŠ” ì„ íƒì‚¬í•­</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">ğŸ“„ JSON íŒŒì¼ í˜•ì‹</h5>
                        </div>
                        <div class="card-body">
                            <p>JSON íŒŒì¼ì€ ë‹¤ìŒê³¼ ê°™ì€ í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤:</p>
                            <pre class="bg-light p-2 rounded">[
  {
    "title": "íŒŒì´ì¬ í”„ë¡œê·¸ë˜ë°",
    "author": "ê¹€ì² ìˆ˜",
    "publisher": "í•œë¹›ë¯¸ë””ì–´",
    "publication_year": 2023
  },
  {
    "title": "ì¥ê³  ì›¹ ê°œë°œ",
    "author": "ì´ì˜í¬",
    "publisher": "ì •ë³´ë¬¸í™”ì‚¬",
    "publication_year": 2022
  }
]</pre>
                            <p class="text-muted small">* titleê³¼ authorëŠ” í•„ìˆ˜, publisherì™€ publication_yearëŠ” ì„ íƒì‚¬í•­</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- íŒŒì¼ ì—…ë¡œë“œ í¼ -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">ğŸ“¤ íŒŒì¼ ì—…ë¡œë“œ</h5>
                </div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="file_title">íŒŒì¼ ì„¤ëª…</label>
                            <input type="text" class="form-control" id="file_title" name="title" placeholder="ì˜ˆ: ë„ì„œê´€ ì‹ ê·œ ë„ì„œ ëª©ë¡">
                        </div>
                        <div class="form-group">
                            <label for="file">íŒŒì¼ ì„ íƒ</label>
                            <input type="file" class="form-control-file" id="file" name="file" accept=".csv,.json" required>
                            <small class="form-text text-muted">CSV ë˜ëŠ” JSON íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</small>
                        </div>
                        <button type="submit" class="btn btn-primary">ì—…ë¡œë“œ</button>
                    </form>
                </div>
            </div>

            <!-- ìƒ˜í”Œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">ğŸ“¥ ìƒ˜í”Œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ</h5>
                </div>
                <div class="card-body">
                    <p>í…ŒìŠ¤íŠ¸ìš© ìƒ˜í”Œ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
                    <div class="row">
                        <div class="col-md-6">
                            <a href="#" class="btn btn-outline-primary" onclick="downloadSampleCSV()">
                                ğŸ“„ CSV ìƒ˜í”Œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                            </a>
                        </div>
                        <div class="col-md-6">
                            <a href="#" class="btn btn-outline-success" onclick="downloadSampleJSON()">
                                ğŸ“„ JSON ìƒ˜í”Œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì—…ë¡œë“œ ê²°ê³¼ -->
    {% if uploaded_file_url or success_count > 0 or error_count > 0 %}
    <div class="card mt-4">
        <div class="card-header">
            <h5 class="mb-0">ğŸ“‹ ì—…ë¡œë“œ ê²°ê³¼</h5>
        </div>
        <div class="card-body">
            {% if uploaded_file_url %}
            <p><strong>ì—…ë¡œë“œëœ íŒŒì¼:</strong> {{ title }}</p>
            <p><strong>íŒŒì¼ ê²½ë¡œ:</strong> <a href="{{ uploaded_file_url }}" target="_blank">{{ uploaded_file_url }}</a></p>
            {% endif %}
            
            {% if success_count > 0 %}
            <div class="alert alert-success">
                <strong>âœ… ì„±ê³µ:</strong> {{ success_count }}ê°œì˜ ë„ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.
            </div>
            {% endif %}
            
            {% if error_count > 0 %}
            <div class="alert alert-danger">
                <strong>âŒ ì˜¤ë¥˜:</strong> {{ error_count }}ê°œì˜ í•­ëª©ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
            </div>
            {% endif %}
            
            {% if errors %}
            <div class="alert alert-warning">
                <strong>âš ï¸ ì˜¤ë¥˜ ìƒì„¸:</strong>
                <ul class="mb-0">
                    {% for error in errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            
            {% if success_count > 0 %}
            <div class="text-center mt-3">
                <a href="{% url 'library:book_list' %}" class="btn btn-success">ë“±ë¡ëœ ë„ì„œ ëª©ë¡ ë³´ê¸°</a>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block script %}
<script>
function downloadSampleCSV() {
    const csvContent = "title,author,publisher,publication_year\níŒŒì´ì¬ í”„ë¡œê·¸ë˜ë°,ê¹€ì² ìˆ˜,í•œë¹›ë¯¸ë””ì–´,2023\nì¥ê³  ì›¹ ê°œë°œ,ì´ì˜í¬,ì •ë³´ë¬¸í™”ì‚¬,2022\në°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„,ë°•ë¯¼ìˆ˜,êµë³´ë¬¸ê³ ,2021\nì›¹ ê°œë°œ ì‹¤ì „,ìµœì§€ì˜,ê¸¸ë²—,2020";
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "sample_books.csv";
    link.click();
}

function downloadSampleJSON() {
    const jsonContent = JSON.stringify([
        {
            "title": "íŒŒì´ì¬ í”„ë¡œê·¸ë˜ë°",
            "author": "ê¹€ì² ìˆ˜",
            "publisher": "í•œë¹›ë¯¸ë””ì–´",
            "publication_year": 2023
        },
        {
            "title": "ì¥ê³  ì›¹ ê°œë°œ",
            "author": "ì´ì˜í¬",
            "publisher": "ì •ë³´ë¬¸í™”ì‚¬",
            "publication_year": 2022
        },
        {
            "title": "ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„",
            "author": "ë°•ë¯¼ìˆ˜",
            "publisher": "êµë³´ë¬¸ê³ ",
            "publication_year": 2021
        },
        {
            "title": "ì›¹ ê°œë°œ ì‹¤ì „",
            "author": "ìµœì§€ì˜",
            "publisher": "ê¸¸ë²—",
            "publication_year": 2020
        }
    ], null, 2);
    const blob = new Blob([jsonContent], { type: 'application/json;charset=utf-8;' });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "sample_books.json";
    link.click();
}

// íƒ­ ì „í™˜ ì‹œ í¼ ì´ˆê¸°í™”
$(document).ready(function() {
    $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
        // íƒ­ì´ ë³€ê²½ë  ë•Œ í¼ í•„ë“œ ì´ˆê¸°í™”
        if (e.target.id === 'text-tab') {
            $('#file').prop('required', false);
        } else if (e.target.id === 'file-tab') {
            $('#file').prop('required', true);
        }
    });
});
</script>
{% endblock %} 