{% extends 'base.html' %}
{% load pybo_filter %}

{% block content %}
<div class="container my-3">
    <!-- í˜ì´ì§€ í—¤ë” -->
    <div class="jumbotron">
        <h1 class="display-4">ğŸ“š ì±…ì— ëŒ€í•˜ì—¬</h1>
        <p class="lead">ë„ì„œì— ëŒ€í•œ í† ë¡ ê³¼ ì˜ê²¬ì„ ë‚˜ëˆ„ëŠ” ê³µê°„ì…ë‹ˆë‹¤.</p>
        <hr class="my-4">
        <a href="{% url 'pybo:book_qa_index' %}" class="btn btn-secondary">â† ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>

    <!-- ë„ì„œ ì •ë³´ -->
    <div class="card mb-3">
        <div class="card-header">
            <h5 class="mb-0">ğŸ“– í† ë¡  ëŒ€ìƒ ë„ì„œ</h5>
        </div>
        <div class="card-body">
            <h6 class="card-title">{{ discussion.book.title }}</h6>
            <p class="card-text">
                <strong>ì €ì:</strong> {{ discussion.book.author }}<br>
                {% if discussion.book.publisher %}
                <strong>ì¶œíŒì‚¬:</strong> {{ discussion.book.publisher }}<br>
                {% endif %}
                {% if discussion.book.publication_year %}
                <strong>ì¶œíŒë…„ë„:</strong> {{ discussion.book.publication_year }}
                {% endif %}
            </p>
        </div>
    </div>

    <!-- í† ë¡  ë‚´ìš© -->
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">ğŸ’¬ í† ë¡  ë‚´ìš©</h5>
        </div>
        <div class="card-body">
            <h4 class="card-title">{{ discussion.subject }}</h4>
            <p class="card-text">{{ discussion.content|mark }}</p>
            <div class="d-flex justify-content-between align-items-center">
                <div class="text-muted">
                    <small>
                        ì‘ì„±ì: {{ discussion.author.username }} | 
                        ì‘ì„±ì¼ì‹œ: {{ discussion.create_date|date:"Y-m-d H:i" }}
                        {% if discussion.modify_date %}
                        | ìˆ˜ì •ì¼ì‹œ: {{ discussion.modify_date|date:"Y-m-d H:i" }}
                        {% endif %}
                    </small>
                </div>
                <div>
                    {% if user == discussion.author %}
                    <a href="{% url 'pybo:book_discussion_modify' discussion.id %}" class="btn btn-sm btn-outline-secondary">ìˆ˜ì •</a>
                    {% endif %}
                    {% if user.is_authenticated %}
                    <a href="#" class="recommend btn btn-sm btn-outline-{% if user in discussion.voter.all %}danger{% else %}secondary{% endif %}" data-uri="{% url 'pybo:book_discussion_vote' discussion.id %}" data-voted="{% if user in discussion.voter.all %}true{% else %}false{% endif %}">
                        {% if user in discussion.voter.all %}ì¶”ì²œì·¨ì†Œ{% else %}ì¶”ì²œ{% endif %}
                        <span class="badge badge-secondary">{{ discussion.voter.count }}</span>
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- ë‹µê¸€ ëª©ë¡ -->
    <div class="card mt-3">
        <div class="card-header">
            <h5 class="mb-0">ğŸ’­ ë‹µê¸€ ëª©ë¡</h5>
        </div>
        <div class="card-body">
            {% if reply_list %}
            {% for reply in reply_list %}
            <div class="card mb-2">
                <div class="card-body">
                    <p class="card-text">{{ reply.content|mark }}</p>
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="text-muted">
                            <small>
                                ì‘ì„±ì: {{ reply.author.username }} | 
                                ì‘ì„±ì¼ì‹œ: {{ reply.create_date|date:"Y-m-d H:i" }}
                                {% if reply.modify_date %}
                                | ìˆ˜ì •ì¼ì‹œ: {{ reply.modify_date|date:"Y-m-d H:i" }}
                                {% endif %}
                            </small>
                        </div>
                        <div>
                            {% if user == reply.author %}
                            <a href="{% url 'pybo:reply_modify' reply.id %}" class="btn btn-sm btn-outline-secondary">ìˆ˜ì •</a>
                            {% endif %}
                            {% if user.is_authenticated %}
                            <a href="#" class="recommend btn btn-sm btn-outline-{% if user in reply.voter.all %}danger{% else %}secondary{% endif %}" data-uri="{% url 'pybo:reply_vote' reply.id %}" data-voted="{% if user in reply.voter.all %}true{% else %}false{% endif %}">
                                {% if user in reply.voter.all %}ì¶”ì²œì·¨ì†Œ{% else %}ì¶”ì²œ{% endif %}
                                <span class="badge badge-secondary">{{ reply.voter.count }}</span>
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <p class="text-muted">ì•„ì§ ë‹µê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endif %}
        </div>
    </div>

    <!-- ë‹µê¸€ ì‘ì„± í¼ -->
    {% if user.is_authenticated %}
    <div class="card mt-3">
        <div class="card-header">
            <h5 class="mb-0">âœï¸ ë‹µê¸€ ì‘ì„±</h5>
        </div>
        <div class="card-body">
            <form method="post" class="my-3" action="{% url 'pybo:reply_create' discussion.id %}">
                {% csrf_token %}
                <div class="form-group">
                    <textarea name="content" id="content" class="form-control" rows="10" placeholder="ë‹µê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
                <input type="submit" value="ë‹µê¸€ë“±ë¡" class="btn btn-primary">
            </form>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block script %}
<script type='text/javascript'>
$(document).ready(function(){
    $(".recommend").on('click', function() {
        var isVoted = $(this).data('voted') === 'true';
        var message = isVoted ? "ì¶”ì²œì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?" : "ì¶”ì²œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?";
        
        if(confirm(message)) {
            location.href = $(this).data('uri');
        }
    });
});
</script>
{% endblock %} 